{% extends 'core/base.html' %}
{% load static %}

{% block title %}Freelancer Dashboard{% endblock %}

{% block extra_css %}
    <link rel="stylesheet" href="{% static 'css/dashboard_styles.css' %}">
{% endblock %}

{% block content %}
<div class="container">
    <div class="main-body">

          {% if messages %}
              {% for message in messages %}
                  <div class="alert alert-{% if message.tags == 'error' %}danger{% elif message.tags == 'warning' %}warning{% elif message.tags == 'success' %}success{% else %}info{% endif %} alert-dismissible fade show mb-3" role="alert">
                      {{ message }}
                      <button type="button" class="btn-close btn-close-white" data-bs-dismiss="alert" aria-label="Close"></button>
                  </div>
              {% endfor %}
          {% endif %}

          <div class="row gutters-sm">
            <div class="col-md-4 mb-3">
              <div class="card">
                <div class="card-body">
                  <div class="d-flex flex-column align-items-center text-center">
                    {% if freelancer.profile_picture %}
                        <img src="{{ freelancer.profile_picture.url }}" alt="{{ freelancer.first_name }}'s Profile" class="rounded-circle profile-picture-lg">
                    {% else %}
                        <img src="https://via.placeholder.com/150/2d3748/e2e8f0?text=No+Photo" alt="Default Profile" class="rounded-circle profile-picture-lg">
                    {% endif %}
                    <div class="mt-3">
                      <h4>{{ freelancer.first_name }} {{ freelancer.last_name }}</h4>
                      <p class="text-secondary mb-1">{{ freelancer.headline|default:"Freelancer" }}</p>
                      <p class="text-secondary font-size-sm mb-3">{{ freelancer.location|default:"Location not set" }}</p>
                    </div>
                  </div>
                </div>
              </div>
            </div>

            <div class="col-md-8">
              <div class="card mb-3">
                <div class="card-body">
                  <h5 class="card-title mb-4">Profile Details</h5>
                  <div class="row mb-3">
                    <div class="col-sm-3"><h6 class="mb-0">Full Name</h6></div>
                    <div class="col-sm-9 text-secondary">{{ freelancer.first_name }} {{ freelancer.last_name }}</div>
                  </div>
                  <div class="row mb-3">
                    <div class="col-sm-3"><h6 class="mb-0">Email</h6></div>
                    <div class="col-sm-9 text-secondary">{{ freelancer.user.email }}</div>
                  </div>
                  <div class="row mb-3">
                    <div class="col-sm-3"><h6 class="mb-0">Phone</h6></div>
                    <div class="col-sm-9 text-secondary">{{ freelancer.phone_number|default:"N/A" }}</div>
                  </div>
                  <div class="row mb-3">
                    <div class="col-sm-3"><h6 class="mb-0">Location</h6></div>
                    <div class="col-sm-9 text-secondary">{{ freelancer.location|default:"N/A" }}</div>
                  </div>
                   <div class="row mb-3">
                    <div class="col-sm-3"><h6 class="mb-0">Experience</h6></div>
                    <div class="col-sm-9 text-secondary">{{ freelancer.experience_years|default:"N/A" }} years</div>
                  </div>
                   <div class="row mb-3">
                    <div class="col-sm-3"><h6 class="mb-0">Hourly Rate</h6></div>
                    <div class="col-sm-9 text-secondary">₹{{ freelancer.expected_hourly_rate|default:"N/A" }}</div>
                  </div>
                  <hr>
                   <div class="row mb-3">
                    <div class="col-sm-3"><h6 class="mb-0">Skills</h6></div>
                    <div class="col-sm-9 text-secondary">
                         {% for skill in freelancer.skills.all %}
                            <span class="badge bg-primary me-1 skill-badge">{{ skill.name }}</span>
                        {% empty %}
                            <span class="fst-italic">No skills added yet.</span>
                        {% endfor %}
                    </div>
                  </div>
                   {% if freelancer.profile_summary %}
                   <hr>
                   <div class="row mb-3">
                        <div class="col-sm-3"><h6 class="mb-0">Summary</h6></div>
                        <div class="col-sm-9 text-secondary">{{ freelancer.profile_summary|linebreaksbr }}</div>
                   </div>
                   {% endif %}
                   <hr>
                   <div class="row">
                        <div class="col-sm-12 profile-actions">
                             <a href="{% url 'edit_profile' %}" class="btn btn-primary">Edit Profile</a>
                             {% if freelancer.resume %}
                                <a href="{{ freelancer.resume.url }}" class="btn btn-outline-primary" download>Resume</a>
                             {% endif %}
                             <a href="{% url 'job_list' %}" class="btn btn-info">Browse Jobs</a>
                        </div>
                   </div>
                </div>
              </div>

              <div class="card">
                <div class="card-body">
                  <h5 class="card-title mb-4">My Accepted Gigs</h5>
                  {% if accepted_gigs %}
                      {% for application in accepted_gigs %}
                          <div class="gig-card mb-3">
                              <div class="card-body">
                                  <h6 class="card-title mb-1">{{ application.job.title }}</h6>
                                  <p class="card-subtitle mb-2 text-secondary small">
                                      With: {{ application.job.recruiter.company_name|default:"Recruiter" }}
                                  </p>
                                  <p class="card-text small mb-1">
                                      <strong class="text-secondary">Location:</strong> {{ application.job.location }}
                                  </p>
                                  <p class="card-text small mb-1">
                                      <strong class="text-secondary">Rate:</strong> ₹{{ application.job.rate_amount|default:"N/A" }} ({{ application.job.get_rate_type_display }})
                                  </p>
                                  <a href="{% url 'job_detail' application.job.id %}" class="card-link small">View Original Job Post</a>
                              </div>
                          </div>
                      {% endfor %}
                  {% else %}
                      <div class="alert alert-secondary text-center" role="alert">
                          You have no accepted gigs yet. Keep applying!
                      </div>
                  {% endif %}
                </div>
              </div>

            </div>
          </div>

        </div>
    </div>
    <div class="card mt-3">
                <div class="card-body">
                  <h5 class="card-title mb-4">Recommended Jobs for You</h5>
                  {% if recommended_jobs %}
                      {% for job in recommended_jobs %}
                          <div class="gig-card mb-3">
                              <div class="card-body">
                                  <h6 class="card-title mb-1">{{ job.title }}</h6>
                                  <p class="card-subtitle mb-2 text-secondary small">
                                      With: {{ job.recruiter.company_name|default:"Recruiter" }}
                                  </p>
                                  <p class="card-text small mb-1">
                                      <strong class="text-secondary">Location:</strong> {{ job.location }}
                                  </p>
                                  <a href="{% url 'job_detail' job.id %}" class="card-link small">View Details</a>
                              </div>
                          </div>
                      {% endfor %}
                  {% else %}
                      <div class="alert alert-secondary text-center" role="alert">
                          No job recommendations available at the moment.
                      </div>
                  {% endif %}
                </div>
              </div>
{% endblock %}

{% block extra_js %}
{% endblock %}
